<h1>Members</h1>
<div id="member-list"></div>

<h2>Add Member</h2>
<form id="add-member-form">
    <input type="text" name="name" placeholder="Name" required>
    <input type="email" name="email" placeholder="Email">
    <button type="submit">Add Member</button>
</form>

<script>
    async function fetchMembers() {
        const res = await fetch(`${apiBase}/members`);
        const members = await res.json();
        const list = document.getElementById("member-list");
        list.innerHTML = members.map(m => `
            <div>
                <strong>${m.name}</strong> (${m.email || 'N/A'}) 
                Outstanding Fee: Rs.${m.outstanding_fee} 
                <button onclick="deleteMember(${m.id})">Delete</button>
            </div>
        `).join('');
    }

    document.getElementById("add-member-form").addEventListener("submit", async e => {
        e.preventDefault();
        const form = e.target;
        const data = Object.fromEntries(new FormData(form));
        const res = await fetch(`${apiBase}/members`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });
        const result = await res.json();
        alert(result.message);
        form.reset();
        fetchMembers();
    });

    async function deleteMember(id) {
        if (!confirm("Are you sure?")) return;
        const res = await fetch(`${apiBase}/members/${id}`, { method: "DELETE" });
        const result = await res.json();
        alert(result.message);
        fetchMembers();
    }

    fetchMembers();
</script>
